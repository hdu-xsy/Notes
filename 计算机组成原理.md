# 控制器

## 控制器的组成及指令的执行

### 基本的计算机组成和功能
计算机系统的基本组成主要包括三个部分:中央处理器(cpu)、存储器和I/O系统，它们之间都是通过总线连接的。从物理上来说，总线就是一组导线，起作用就是把信息从一个部件传到另一个部件。  
连接系统的总线包括三种信号：地址信号、数据信号和控制信号，传送这三种新号的总线分别称为地址总线AB、数据总线DB和控制总线CB。  
地址总线总是来自于CPU或总线主设备、数据总线的作用是在CPU、存储器和I/O设备之间传送数据  
计算机的主机包括运算器、控制器和主存三部分。运算器和控制器一起构成了CPU，它是整个计算机系统的核心。  
CPU具有以下四个方面的基本功能:1.指令控制，确保计算机指令按程序的顺序执行。2.操作控制，一条指令的功能通常由若干个操作信号组合起来实现，cpu控制这些微操作的产生、组合、传送和管理。3.时间控制，使各种微操作和指令的执行严格按照时间序列进行。4.数据加工，由运算器对数据进行算术运算和逻辑运算。

### 控制器的组成
1. 程序计数器PC  
程序计数器的功能是用来存放当前正在执行的指令地址或者下一条指令的地址。
2. 指令寄存器  
控制器从内存中取出指令，存放在指令寄存器IR中，以便控制器对指令进行译码、执行。
3. 指令译码器  
指令划分为操作码和地址码字段，为了执行指令寄存器中的指令，必须对操作码进行译码以识别该指令所要求的操作。
4. 操作控制信号形成部件  
根据指令操作码的译码信号以及时序信号，产生取出指令和执行这条指令所需的各种操作控制信号，以便正确地建立数据通路，完成取出指令和执行指令的控制。
5. 时序信号产生器
提供时钟信号和机器周期信号，以规定每个操作的时间。
6. 地址寄存器AR  
专门的收纳可能有多种来源的地址，然后统一在规定的节拍将地址送上总线的寄存器
7. 数据寄存器DR
当CPU把数据发送到存储器或I/O设备是，CPU一般会将数据送入DR，然后再从DR将数据送上数据总线。 

### 时序及控制方式
1. 时序信号
    1. 指令周期
    计算机取出一条指令并完成该指令的执行所需要的时间。
    2. 机器周期/CPU周期
    CPU与内存交换一次信息所需要的时间。
    3. 时钟周期/节拍周期
    一个CPU周期包含若干个时钟周期，是处理操作的最基本时间单位
一个机器周期需要多少个节拍最合适取决于该周期时间内需要顺序完成的基本操作步数，可采用下述方法确定：统一节拍法、分散节拍法、延长节拍法、时钟周期插入
2. 时序信号产生器
产生指令周期中各时序信号的逻辑电路，由时钟源、环形脉冲发生器、节拍脉冲逻辑、启停控制逻辑等部分构成
3. 控制方式
    1. 同步控制方式
    2. 异步控制方式
    3. 联合控制方式

## 数据通路和指令的执行过程

### 简单计算机系统的数据通路
- 存储器读操作
    1. 送地址到CPU片内总线，并送入地址寄存器AR
    2. 控制器放松存储器读信号，启动存储器读操作，并将读出的数据从数据总线上接收至数据寄存器DR
- 存储器写操作
    1. 送地址到CPU片内总线，并送入地址寄存器AR
    2. 送数据到DR，DR将数据送到数据总线，控制器发送存储器写信号，启动存储器写操作。

### 简单计算机系统主机各部件的实现方案
1. 运算器
2. 控制器
3. 存储器

### 简单计算机系统中指令的执行过程
1. 取指令
控制器先将第一条指令的地址置入程序计数器PC，PC将当前指令的地址送到地址寄存器AR，同时程序计数器PC的内容递增以指向下一条指令的地址，地址寄存器AR的输出通过地址总线送到存储器的地址端，指明指令所在的地址单元，控制器发出读控制信号，控制从存储器中读出这条指令；该指令通过数据总线送到指令寄存器IR。指令取到指令寄存器IR后，立即由指令译码器对其进行分析译码；指令译码器首先判断该指令是什么指令，然后将判断结果信息传递给操作控制信号形成部件。
2. 执行指令
操作控制信号形成部件根据指令译码信息和时序周期信号，发出该指令所需的所有不见的有一定时序关系的控制信号序列，完成指令的执行。

### MIPS单周期CPU的数据通路和指令的执行过程
1. 分析MIPS的指令格式，以及每种格式下指令的功能。
2. 根据指令功能，罗列所需器件和器件之间的连接方式。
3. 确定每个期间所需的控制信号。

单周期MIPS CPU要求在每个时钟周期执行一条指令。为保持在执行指令期间，指令存储器取出的指令不变，PC值在指令执行期间必须保持不变，因此PC+4的值应该在下个指令周期开始的时候付给PC。添加一个暂存PC自增值的寄存器PC_new，在指令周期clk的上升沿执行取指令操作，在clk的下降沿更新PC值。系统启动时PC复位，添加复位信号rst。

- R型指令数据通路的设计
所有R型指令的共同特征是:操作码字段OP=000000b,指令的功能由功能码字段func指出。每条R型指令的操作数有3个，两个源操作数分别位于rs和rt字段所指定的寄存器中，而目的操作数则位于rd字段所制定的寄存器中。